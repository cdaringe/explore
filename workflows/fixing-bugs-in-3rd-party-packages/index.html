<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
 <head><title>Fixing Bugs in 3rd Party Packages</title>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta charset="utf-8"/>
  <meta name="description"
   content="Track down and fix bugs in libraries that you use"/>
  <link rel="stylesheet"
   href="https://fonts.googleapis.com/css2?family=Roboto+Mono&amp;family=Ubuntu:ital,wght@0,400;0,700;1,400&amp;display=swap"
   />
  <link rel="stylesheet"
   href="https://unpkg.com/purecss@2.0.0/build/base.css"/>
  <link rel="stylesheet"
   href="https://unpkg.com/purecss@2.0.0/build/grids-core.css"/>
  <link rel="stylesheet"
   href="https://unpkg.com/purecss@2.0.0/build/grids-units.css"/>
  <link rel="stylesheet"
   href="https://unpkg.com/purecss@2.0.0/build/grids-responsive.css"/>
  <link rel="stylesheet"
   href="https://unpkg.com/purecss@2.0.0/build/menus-core.css"/>
  <link rel="stylesheet"
   href="https://unpkg.com/purecss@2.0.0/build/menus-dropdown.css"/>
  <link rel="stylesheet" href="/css/main.css"/>
  <link rel="stylesheet"
   href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.0.0/styles/gruvbox-dark.min.css"
   />
  <script src="https://identity.netlify.com/v1/netlify-identity-widget.js">
  </script>
  <script
   src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.0.0/highlight.min.js"
   >
  </script>
  <script charset="UTF-8"
   src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.0.0/languages/ocaml.min.js"
   >
  </script><script>hljs.initHighlightingOnLoad();</script>
 </head>
 <body>
             
  <header>
                  
   <a class="skip-to-content" href="#main"> Skip to main content </a>
   <div class="pure-g">
                             
    <div class="pure-u-1-3">
                                    
     <a class="title-link" href="/">
                                              
      <h2 style="text-align: center">Explore OCaml</h2>
                                                               
     </a>
               
    </div>
                
    <div class="pure-u-1-3"></div>
                                          
    <nav class="pure-hidden-xs pure-hidden-sm pure-u-1-3 flex-col flex-vert">
     
               
     <ul class="flex-row flex-center nav-ul">
      <li class="nav-button">
                                           
       <a href="/platform">
                                           Tools 
                                         </a>
       
                   
      </li>
      <li class="nav-button">
                                           
       <a href="/users">
                                        Users
                                      </a>
       
                   
      </li>
      <li class="nav-button">
                                           
       <a href="/libraries">
                                            Libraries
                                          </a>
       
                   
      </li>
     </ul>
                  
    </nav>
                  
    <nav class="pure-hidden-md pure-hidden-lg pure-hidden-xl pure-menu
     pure-menu-horizontal flex-col flex-vert pure-u-1-3">
                                                                   
     <ul class="pure-menu-list" style="text-align: center">
      <li class="pure-menu-item pure-menu-has-children pure-menu-allow-hover">
       
                   <a href="#" id="menuLink1" class="pure-menu-link">Menu</a>
       
                   
       <ul class="pure-menu-children mob-menu-list">
        <li class="pure-menu-item mob-menu-item">
                                                                   
         <a href="/platform">
                                                 Tools 
                                               </a>
         
                         
        </li>
        <li class="pure-menu-item mob-menu-item">
                                                                   
         <a href="/users">
                                              Users
                                            </a>
         
                         
        </li>
        <li class="pure-menu-item mob-menu-item">
                                                                   
         <a href="/libraries">
                                                Libraries
                                                
         </a>
                             
        </li>
       </ul>
                        
      </li>
     </ul>
                  
    </nav>
              
   </div>
               
  </header>
                   
  <div class="pure-g">
                                
   <div class="pure-u-1-12 pure-u-md-1-4">
                                                      
    <div class="pure-hidden-xs pure-hidden-sm pure-hidden-md toc-container
     sticky">
     <ul class="toc">
      <li>
       <ul class="toc">
        <li>
         <a class="toc-link toc-item-1"
          href="#fixing-bugs-in-3rd-party-packages">
          Fixing Bugs in 3rd Party Packages
         </a>
         <ul class="toc">
          <li class="toc-li">
           <a class="toc-link toc-item-2" href="#overview">Overview</a>
          </li>
         </ul>
         <ul class="toc">
          <li>
           <a class="toc-link toc-item-2" href="#recommended-workflow">
            Recommended Workflow
           </a>
           <ul class="toc">
            <li class="toc-li">
             <a class="toc-link toc-item-3" href="#getting-the-source-code">
              Getting the Source Code
             </a>
            </li>
           </ul>
           <ul class="toc">
            <li class="toc-li">
             <a class="toc-link toc-item-3" href="#locally-pinning">
              Locally pinning
             </a>
            </li>
           </ul>
           <ul class="toc">
            <li class="toc-li">
             <a class="toc-link toc-item-3"
              href="#subsequent-changes-&amp;-upgrading">
              Subsequent Changes &amp; Upgrading
             </a>
            </li>
           </ul>
          </li>
         </ul>
        </li>
       </ul>
      </li>
     </ul>
    </div>
                    
   </div>
                   
   <div class="pure-u-5-6 pure-u-md-1-2">
                                                     
    <main id="main"> 
     <h1 id="fixing-bugs-in-3rd-party-packages">Fixing Bugs in 3rd Party Packages</h1>
<p><em>Last Updated: 27, July 2020 at 09:35:49</em></p>
<div><p>Platform tools: <span class="details-tools"><a href="/platform/dune">Dune</a></span></p></div>
<h2 id="overview">Overview</h2>
<p>Working with third-party packages means coming across areas for improvement or those that need fixing. Knowing how common codebases are structured and an appreciation for the tools allows you to more easily:</p>
<ul>
<li>Fix the bug if you know how.
</li>
<li>Raise an issue wherever the code is being hosted on.
</li>
<li>Find and comment on an existing issue with extra information you have from my own debugging.
</li>
</ul>
<p>This will also give you insight into how you can structure your own code to allow others to more easily debug it.</p>
<p>There are multiple aspects to unpack in this workflow including:</p>
<ol>
<li>Getting the source code.
</li>
<li>Pinning packages locally.
</li>
<li>Logging libraries
</li>
</ol>
<p>Quite a lot of this workflow is made simpler by using the <a href="/pages/opam-client">opam client</a>.</p>
<h2 id="recommended-workflow">Recommended Workflow</h2>
<h3 id="getting-the-source-code">Getting the Source Code</h3>
<p>If the library is part of the <em>opam-repository</em> then the easiest way to get the source code is using the opam client: <code>opam source &lt;package&gt;</code> - this can also be given an optional version constraint.</p>
<pre><code class="language-bash"># Downloads latest version of Irmin - at time of writing 2.2.0
opam source irmin

# Download the 2.0.0 version of Irmin
opam source irmin.2.0.0
</code></pre>
<p>If you envisage wanting to make a pull request to fix something then forking and cloning the package is probably a better way to go about it.</p>
<pre><code class="language-bash">git clone https://github.com/patricoferris/irmin.git
cd irmin
git checkout -b my-awesome-fix
</code></pre>
<h3 id="locally-pinning">Locally pinning</h3>
<p>To tell opam that you want to use a modified version of a package you <strong>pin</strong> it. This is like pinning a note to the package in the opam-respository that points to the source code you are developing (rather than the released version from Github).</p>
<pre><code class="language-bash"># In the clone irmin directory 
opam pin add irmin . --kind=path 
</code></pre>
<p>Note: it is quite common to have multiple opam packages per repository. Irmin for example has <code>irmin</code>, <code>irmin-unix</code>, <code>irmin-graphql</code>... If your changes are only for a certain package it is best to only pin that one package. <code>--kind=path</code> means we don't have to commit the changes as by default opam tries to use git pins.</p>
<p>Opam will rebuild dependent projects as well - depending on what package you change and how many dependent projects you have installed in your switch this can take a bit of time.</p>
<p>Keeping track of what packages you have pinned and which ones you haven't can be done with <code>opam pin list</code> - this will helpfully tell you where the package is pinned to (<code>git+file...</code>, <code>git+https...</code> etc.) and whether or not it is installed.</p>
<h3 id="subsequent-changes-&amp;-upgrading">Subsequent Changes &amp; Upgrading</h3>
<p>Pinning a package tells opam where the source code is coming from but as you add new bits of code, opam doesn't see these. In order to add those you will have to run <code>opam upgrade</code> to get the latest changes of pinned packages.</p>

     <h3>Resources</h3>
     <ol>
      <li>
       <a
        href="http://www.dra27.uk/blog/platform/2018/08/15/dune-vendoring.html"
        >The Joys of Dune Vendoring
       </a> - 
       David Allsopp explains how using dune in the future will make the
       development process (changing dependencies and rebuilding projects)
       much simpler and quicker
      </li>
     </ol>
    </main>
                     
   </div>
                 
  </div>
            
          
        </body>
</html>
