<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
 <head><title>Setting up Continuous Integration</title>
  <meta name="viewport" content="width = device-width, initial-scale = 1"/>
  <link rel="stylesheet"
   href="https://fonts.googleapis.com/css2?family=Roboto+Mono&amp;family=Ubuntu:ital,wght@0,400;0,700;1,400&amp;display=swap"
   />
  <link rel="stylesheet"
   href="https://unpkg.com/purecss@2.0.0/build/base.css"/>
  <link rel="stylesheet"
   href="https://unpkg.com/purecss@2.0.0/build/grids-core.css"/>
  <link rel="stylesheet"
   href="https://unpkg.com/purecss@2.0.0/build/grids-units.css"/>
  <link rel="stylesheet"
   href="https://unpkg.com/purecss@2.0.0/build/grids-responsive.css"/>
  <link rel="stylesheet" href="/static/css/main.css"/>
  <link rel="stylesheet"
   href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.0.0/styles/gruvbox-dark.min.css"
   />
  <script src="https://identity.netlify.com/v1/netlify-identity-widget.js">
  </script>
  <script
   src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.0.0/highlight.min.js"
   >
  </script>
  <script charset="UTF-8"
   src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.0.0/languages/ocaml.min.js"
   >
  </script><script>hljs.initHighlightingOnLoad();</script>
 </head>
 <body>
  <div class="pure-g">
                          
   <div class="pure-u-1-3">
                                 
    <a class="title-link" href="/">
                                           
     <h2 style="text-align: center">Explore OCaml</h2>
                                                            
    </a>
            
   </div>
             
   <div class="pure-u-1-3">
                               </div>
   
       
   <div class="pure-u-1-3 flex-col flex-vert">
                                                    
    <div class="flex-row flex-center">
                                              
     <div class="nav-button">
                                       
      <a href="/platform">
                                      Tools 
                                    </a>
      
              
     </div>
                   
     <div class="nav-button">
                                       
      <a href="/users">
                                   Users
                                 </a>
      
              
     </div>
                   
     <div class="nav-button">
                                       
      <a href="/libraries">
                                     Libraries
                                     </a>
      
              
     </div>
                 
    </div>
              
   </div>
           
  </div>
                
  <div class="pure-g">
                                
   <div class="pure-u-1-12 pure-u-md-1-4">
                                                    </div>
   
             
   <div class="pure-u-5-6 pure-u-md-1-2">
                                                 
    <h2 id="Overview">Overview</h2>

<p><hr/>Continuous integration (CI) has become a basic necessity for managing projects, especially when there are multiple contributors. The idea is that for code to make it into production (or to get a &quot;seal of approval&quot; to move to the main branch) - code should pass a series of quality tests.</p>
<p>These tests may include:</p>
<ol><li>Unit tests - a series of small, functional tests to make sure implementations still do what they are supposed to. </li><li>Integration tests - ensuring multiple components within your project play nicely together </li><li>Formatting - although it may seem pedantic, well-formatted code (with uniformity) across the project makes it (a) easier for people to find bugs and (b) more accessible to new contributors. </li></ol>

<p>The point of CI is to automate most of this away. Wherever your project lives it should constantly be checking that new code meets the quality tests before allowing that code to make into &quot;production&quot;.</p>
<h2 id="Recommended-Workflow">Recommended Workflow</h2>

<p><hr/>Github offers a feature called Github Actions. It works on the principle of <em>workflows -</em> different things you might want to do on different &quot;actions&quot; within your Github repository. This can include releasing code, testing code etc. Here we&#39;re focusing on testing.</p>
<p>To get started you will need to create a <code>.github</code> directory in your repostory and inside it a <code>workflows</code> repository. Now you can specify what you want to happen by creating a <code>config.yml</code> file.</p>
<p>One of the biggest advantages of Github Actions is the modularity and &quot;action reuse&quot;. For example if you needed to use &quot;curl&quot; to get some resource from the internet or trigger some event at an endpoint <a href='https://github.com/marketplace/actions/github-action-for-curl'>there&#39;s an action for that</a>.</p>
<p>So what does a basic OCaml config file for making quality tests look like?</p>
<pre class='yaml'><code class='yaml'>name: ospike
on: [push]
jobs:
  run:
    name: tests
    runs-on: ${{ matrix.os }}
    strategy:
      matrix:
        os: [ubuntu-latest]
        ocaml-version: [&quot;4.07.0&quot;]
    steps:
      - name: Checkout code
        uses: actions/checkout@master
      - name: Use OCaml ${{ matrix.ocaml-version }}
        uses: avsm/setup-ocaml@v1.0
        with:
          ocaml-version: ${{ matrix.ocaml-version }}
      - run: opam pin add ospike.dev -n .
      - run: opam depext -yt ospike
      - name: Install Deps
        run: opam install -t . --deps-only
      - name: Build
        run: opam exec -- dune build
      - name: Test
        run: opam exec -- dune runtest</code></pre>

<h2 id="Alternatives">Alternatives</h2>

<p><hr/>TravisCI is a continuous integration tool that is very flexible and also robust. There are two main ways you can use TravisCI.</p>
<p><code>ocaml-ci-scripts</code> is a collection of useful scripts for building a complex CI testing platform. One of the main goals of CI is to make sure your code runs well <em>everywhere.</em> This implies forming a matrix of operating systems and OCaml compiler versions to make sure your code runs properly.</p>
<p>There are quite few scripts such as <code>.travis.opam.sh</code> ,  <code>.travis.docker.sh</code> and even <code>.travis.mirage.sh</code></p>
<p>Each is built around environment variables in order to execute different jobs with say different linux distributions, ocaml versions etc.</p>
<h2 id="Real-World-Examples">Real World Examples</h2>

<p><hr/><a href='https://github.com/avsm/ocaml-yaml/blob/master/.github/workflows/test.yml'>avsm/ocaml-yaml</a></p>

     
              
   </div>
                 
  </div>
            
          
        </body>
</html>
