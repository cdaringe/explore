<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
 <head><title>Starting a new Project</title>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta charset="utf-8"/>
  <meta name="description"
   content="Build the scaffolding for your solution to a problem"/>
  <link rel="stylesheet"
   href="https://fonts.googleapis.com/css2?family=Roboto+Mono&amp;family=Ubuntu:ital,wght@0,400;0,700;1,400&amp;display=swap"
   />
  <link rel="stylesheet"
   href="https://unpkg.com/purecss@2.0.0/build/base.css"/>
  <link rel="stylesheet"
   href="https://unpkg.com/purecss@2.0.0/build/grids-core.css"/>
  <link rel="stylesheet"
   href="https://unpkg.com/purecss@2.0.0/build/grids-units.css"/>
  <link rel="stylesheet"
   href="https://unpkg.com/purecss@2.0.0/build/grids-responsive.css"/>
  <link rel="stylesheet"
   href="https://unpkg.com/purecss@2.0.0/build/menus-core.css"/>
  <link rel="stylesheet"
   href="https://unpkg.com/purecss@2.0.0/build/menus-dropdown.css"/>
  <link rel="stylesheet" href="/css/main.css"/>
  <link rel="stylesheet"
   href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.0.0/styles/gruvbox-dark.min.css"
   />
  <script src="https://identity.netlify.com/v1/netlify-identity-widget.js">
  </script>
  <script
   src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.0.0/highlight.min.js"
   >
  </script>
  <script charset="UTF-8"
   src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.0.0/languages/ocaml.min.js"
   >
  </script><script>hljs.initHighlightingOnLoad();</script>
 </head>
 <body>
             
  <header>
                  
   <a class="skip-to-content" href="#main"> Skip to main content </a>
   <div class="pure-g">
                             
    <div class="pure-u-1-3">
                                    
     <a class="title-link" href="/">
                                              
      <h2 style="text-align: center">Explore OCaml</h2>
                                                               
     </a>
               
    </div>
                
    <div class="pure-u-1-3"></div>
                                          
    <nav class="pure-hidden-xs pure-hidden-sm pure-u-1-3 flex-col flex-vert">
     
               
     <ul class="flex-row flex-center nav-ul">
      <li class="nav-button">
                                           
       <a href="/platform">
                                           Tools 
                                         </a>
       
                   
      </li>
      <li class="nav-button">
                                           
       <a href="/users">
                                        Users
                                      </a>
       
                   
      </li>
      <li class="nav-button">
                                           
       <a href="/libraries">
                                            Libraries
                                          </a>
       
                   
      </li>
     </ul>
                  
    </nav>
                  
    <nav class="pure-hidden-md pure-hidden-lg pure-hidden-xl pure-menu
     pure-menu-horizontal flex-col flex-vert pure-u-1-3">
                                                                   
     <ul class="pure-menu-list" style="text-align: center">
      <li class="pure-menu-item pure-menu-has-children pure-menu-allow-hover">
       
                   <a href="#" id="menuLink1" class="pure-menu-link">Menu</a>
       
                   
       <ul class="pure-menu-children mob-menu-list">
        <li class="pure-menu-item mob-menu-item">
                                                                   
         <a href="/platform">
                                                 Tools 
                                               </a>
         
                         
        </li>
        <li class="pure-menu-item mob-menu-item">
                                                                   
         <a href="/users">
                                              Users
                                            </a>
         
                         
        </li>
        <li class="pure-menu-item mob-menu-item">
                                                                   
         <a href="/libraries">
                                                Libraries
                                                
         </a>
                             
        </li>
       </ul>
                        
      </li>
     </ul>
                  
    </nav>
              
   </div>
               
  </header>
                   
  <div class="pure-g">
                                
   <div class="pure-u-1-12 pure-u-md-1-4">
                                                      
    <div class="pure-hidden-xs pure-hidden-sm pure-hidden-md toc-container
     sticky">
     <ul class="toc">
      <li>
       <ul class="toc">
        <li>
         <a class="toc-link toc-item-1" href="#starting-a-new-project">
          Starting a new Project
         </a>
         <ul class="toc">
          <li class="toc-li">
           <a class="toc-link toc-item-2" href="#overview">Overview</a>
          </li>
         </ul>
         <ul class="toc">
          <li>
           <a class="toc-link toc-item-2" href="#recommended-workflow">
            Recommended Workflow
           </a>
           <ul class="toc">
            <li class="toc-li">
             <a class="toc-link toc-item-3" href="#opam-and-dune">
              Opam and Dune
             </a>
            </li>
           </ul>
           <ul class="toc">
            <li class="toc-li">
             <a class="toc-link toc-item-3" href="#adding-dune-files">
              Adding Dune Files
             </a>
            </li>
           </ul>
           <ul class="toc">
            <li class="toc-li">
             <a class="toc-link toc-item-3" href="#using-libraries">
              Using Libraries
             </a>
            </li>
           </ul>
           <ul class="toc">
            <li class="toc-li">
             <a class="toc-link toc-item-3" href="#generating-an-opam-file">
              Generating an Opam File
             </a>
            </li>
           </ul>
           <ul class="toc">
            <li class="toc-li">
             <a class="toc-link toc-item-3" href="#next-steps">Next steps</a>
            </li>
           </ul>
          </li>
         </ul>
         <ul class="toc">
          <li class="toc-li">
           <a class="toc-link toc-item-2" href="#real-world-examples">
            Real World Examples
           </a>
          </li>
         </ul>
        </li>
       </ul>
      </li>
     </ul>
    </div>
                    
   </div>
                   
   <div class="pure-u-5-6 pure-u-md-1-2">
                                                     
    <main id="main"> 
     <h1 id="starting-a-new-project">Starting a new Project</h1>
<p><em>Last Updated: 24, September 2020 at 09:34:26</em></p>
<div><p>Platform tools: <span class="details-tools"><a href="/platform/dune">Dune</a></span></p></div>
<h2 id="overview">Overview</h2>
<p>Starting a new coding project is exciting. This excitement shouldn't be taken away by hard-to-understand (or worse, broken) tooling. There's no correct way to set up your OCaml project, but what follows is a fairly common structure that works for a majority of programs. Along the way we'll be using dune as the the build tool and <a href="/pages/opam">opam</a> as the package manager.</p>
<h2 id="recommended-workflow">Recommended Workflow</h2>
<h3 id="opam-and-dune">Opam and Dune</h3>
<p>For a new library there are two key components you will need, a build tool and a package manager. The build tool compiles your program whether that be to bytecode, assembly or even <a href="/workflows/running-ocaml-in-your-browser">javascript</a>. The package manager allows you to make use of third party libraries and eventually even share your code for others to use.</p>
<p>Most OCaml projects have a structure of <em>binaries</em> (executables), <em>libraries</em> and <em>tests</em>. These map to the three most common dune stanzas: <em>executable, library and test</em>. Not all fall into this structure, but it acts as a simple base to begin building your project. The <a href="/workflows/navigating-ocaml-projects">navigating OCaml projects</a> workflow shines some more light onto this structure.</p>
<p>A typical directory layout would then be:</p>
<pre><code>.
|-- README
|-- dune-project
|-- bin
|   |-- dune
|   `-- main.ml
|-- lib
|   |-- dune
|   `-- numbers.ml
`-- test
    |-- dune
    `-- test.ml
</code></pre>
<h3 id="adding-dune-files">Adding Dune Files</h3>
<p>The <a href="/platform/dune">dune platform page</a> describes some of the key concepts behind dune. One of the most important is its declarative nature and how it builds based on the presence of dune files. It is not uncommon for nearly all directories in your project to have some form of dune file.</p>
<p>Dune has a <code>dune init</code> command that is very simple and will initialise a bare bones project, executable, test or library. For a library we can execute <code>dune init library &lt;library-main-file&gt;</code>. This should generate a &quot;Hello World&quot; file and a simple dune file with a <em>library stanza</em>. If you are using the <a href="/workflows/configuring-ocaml-tools-for-your-editor">VS Code Platform</a>, it supports auto-completion for these files as well.</p>
<pre><code class="language-sh">$ dune init library numbers --libs yaml
Success: initialized library component named numbers
$ cat dune 
(library
 (name numbers)
 (libraries yaml))
</code></pre>
<h3 id="using-libraries">Using Libraries</h3>
<p>Opam allows you to install libraries from the <a href="https://github.com/ocaml/opam-repository">opam-repository</a>. If you run <code>opam install irmin</code> this will build the <a href="https://irmin.io/">irmin</a> library for you in the global switch directory (somewhere like <code>~/.opam/&lt;switch&gt;/lib/irmin</code>) or in the local directory (<code>./_opam</code>). Once installed whenever you add a library to your dune file, dune will be able to build your code to include that library.</p>
<pre><code>(executable
  (name main)
  (libraries irmin))
</code></pre>
<p>You may want to specify a specific version of the libraries you use, or you may even want to use the unreleased development version. Read on about generating opam files to find out how to do this.</p>
<h3 id="generating-an-opam-file">Generating an Opam File</h3>
<p>The next step is to generate your <a href="/pages/opam-file">opam file</a>. An opam file unlocks the power of the opam package manager and often other parts of the OCaml Platform tooling. It is always recommended to have one, even if you have no intention of publishing the code to the central opam repository. There are three ways you can do this:</p>
<ol>
<li>Using opam pin - to edit an opam file you can use <code>opam pin add . --edit</code> this will open an editor with a pre-filled library in it. The slightly confusing aspect to this is that you are also simultaneously pinning the package which you might not want to do. For more information on pinning, <a href="/pages/opam">read the opam page</a>.
</li>
<li>Copying an existing opam file and editing it - from the command line <code>opam show &lt;an-installed-package&gt; --raw</code> will print to stdout the opam file for whatever package you added. You can the redirect this to a file and edit it accordingly.
</li>
<li>By hand - the simplest, but perhaps longest, is to write it by hand.
</li>
</ol>
<p>Regardless of what method you choose, the <code>opam lint</code> command is useful to ensure the opam file has correct syntax.</p>
<p>The standard way is to use the <code>dune-project</code> file to <a href="https://dune.readthedocs.io/en/stable/opam.html#generating-opam-files">generate your opam file</a> . It is a useful way to ensure your dune dependency is correctly versioned. In this approach you can express your opam file in the dune language and this will automatically generate an opam file for you.</p>
<pre><code class="language-sh">$ cat dune-project 
(lang dune 2.7)

(name numbers)

(generate_opam_files true)

(source
 (github alicesmith/numbers))

(license ISC)

(authors &quot;Alice Smith&quot;)

(maintainers &quot;alice@example.com&quot;)

(package
 (name numbers)
 (synopsis &quot;A library for useful number functions&quot;)
 (description &quot;This library provides useful number functions&quot;)
 (depends
  (alcotest :with-test)
  (yaml
   (= 2.1.0))))
$ dune build 
$ cat numbers.opam
# This file is generated by dune, edit dune-project instead
opam-version: &quot;2.0&quot;
synopsis: &quot;A library for useful number functions&quot;
description: &quot;This library provides useful number functions&quot;
maintainer: [&quot;alice@example.com&quot;]
authors: [&quot;Alice Smith&quot;]
license: &quot;ISC&quot;
homepage: &quot;https://github.com/alicesmith/numbers&quot;
bug-reports: &quot;https://github.com/alicesmith/numbers/issues&quot;
depends: [
  &quot;dune&quot; {&gt;= &quot;2.7&quot;}
  &quot;alcotest&quot; {with-test}
  &quot;yaml&quot; {= &quot;2.1.0&quot;}
  &quot;odoc&quot; {with-doc}
]
build: [
  [&quot;dune&quot; &quot;subst&quot;] {dev}
  [
    &quot;dune&quot;
    &quot;build&quot;
    &quot;-p&quot;
    name
    &quot;-j&quot;
    jobs
    &quot;@install&quot;
    &quot;@runtest&quot; {with-test}
    &quot;@doc&quot; {with-doc}
  ]
]
dev-repo: &quot;git+https://github.com/alicesmith/numbers.git&quot;
</code></pre>
<p>Adding dependencies is not automatic in OCaml. For example, you might have <code>yaml</code> already installed and your dune file might add it in a <code>libraries</code> field, but you need to add it to your <code>dune-project</code>'s description of the opam file. This means other people who might not have it installed will get it whenever they try and install your library.</p>
<p>The <code>:with-test</code> flag tells opam that unless specified this dependency does not need to be installed in order to use the package. Another similar flag is <code>:with-doc</code> for documentation only dependencies.</p>
<p>The dune-project file also supports version constraints on the dependencies. Here, <code>yaml</code> must be version <code>2.1.0</code>. The <a href="https://dune.readthedocs.io/en/stable/opam.html#generating-opam-files">dune documentation</a> does a great job explaining what's available.</p>
<p>Note that sometimes you need an escape-hatch as the specification in <code>dune-project</code> for opam files is not as flexible as an opam file - for this you should use the <a href="https://dune.readthedocs.io/en/stable/opam.html#opam-template">templates</a> to include things like <code>pin-depends</code> to add unreleased packages. This website <a href="https://github.com/ocaml-explore/explore/blob/trunk/explore.opam.template">uses a template</a> in order to use unreleased versions of packages -- remember they still need to be dependencies in the opam file as well as pin-depends.</p>
<h3 id="next-steps">Next steps</h3>
<p>The simple project above should be enough to get you started with building OCaml projects outlining the most important features like directory structure, dune files and opam files. There are multiple next steps you can take, here are just a few:</p>
<ul>
<li>Test your libraries using <a href="/workflows/adding-unit-tests-to-your-project">unit tests</a> and the Alcotest library.
</li>
<li>Keep your code clean with <a href="/workflows/keeping-your-code-clean">automatic formatting</a>.
</li>
<li>Add and <a href="/workflows/documenting-your-project">generate documentation</a> for your project.
</li>
<li><a href="/workflows/meta-programming-with-ppx">Preprocess</a> your library using a ppx for adding additional functionality.
</li>
</ul>
<h2 id="real-world-examples">Real World Examples</h2>
<p>Many of the community libraries use dune and opam to build their projects - <a href="https://github.com/mirage/ocaml-cstruct">cstruct</a> and <a href="https://github.com/mirage/alcotest">alcotest</a> are just two of many for example.</p>
<p>Dune itself use the <a href="https://github.com/ocaml/dune/blob/master/dune-project">dune-project</a> approach of generating opam files.</p>

    </main>
                     
   </div>
                 
  </div>
            
          
        </body>
</html>
