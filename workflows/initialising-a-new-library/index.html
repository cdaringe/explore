<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
 <head><title>Initialising a New Library</title>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta charset="utf-8"/>
  <meta name="description"
   content="Build the scaffolding for your solution to a problem"/>
  <link rel="stylesheet"
   href="https://fonts.googleapis.com/css2?family=Roboto+Mono&amp;family=Ubuntu:ital,wght@0,400;0,700;1,400&amp;display=swap"
   />
  <link rel="stylesheet"
   href="https://unpkg.com/purecss@2.0.0/build/base.css"/>
  <link rel="stylesheet"
   href="https://unpkg.com/purecss@2.0.0/build/grids-core.css"/>
  <link rel="stylesheet"
   href="https://unpkg.com/purecss@2.0.0/build/grids-units.css"/>
  <link rel="stylesheet"
   href="https://unpkg.com/purecss@2.0.0/build/grids-responsive.css"/>
  <link rel="stylesheet"
   href="https://unpkg.com/purecss@2.0.0/build/menus-core.css"/>
  <link rel="stylesheet"
   href="https://unpkg.com/purecss@2.0.0/build/menus-dropdown.css"/>
  <link rel="stylesheet" href="/css/main.css"/>
  <link rel="stylesheet"
   href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.0.0/styles/gruvbox-dark.min.css"
   />
  <script src="https://identity.netlify.com/v1/netlify-identity-widget.js">
  </script>
  <script
   src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.0.0/highlight.min.js"
   >
  </script>
  <script charset="UTF-8"
   src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.0.0/languages/ocaml.min.js"
   >
  </script><script>hljs.initHighlightingOnLoad();</script>
 </head>
 <body>
             
  <header>
                  
   <a class="skip-to-content" href="#main"> Skip to main content </a>
   <div class="pure-g">
                             
    <div class="pure-u-1-3">
                                    
     <a class="title-link" href="/">
                                              
      <h2 style="text-align: center">Explore OCaml</h2>
                                                               
     </a>
               
    </div>
                
    <div class="pure-u-1-3"></div>
                                          
    <nav class="pure-hidden-xs pure-hidden-sm pure-u-1-3 flex-col flex-vert">
     
               
     <ul class="flex-row flex-center nav-ul">
      <li class="nav-button">
                                           
       <a href="/platform">
                                           Tools 
                                         </a>
       
                   
      </li>
      <li class="nav-button">
                                           
       <a href="/users">
                                        Users
                                      </a>
       
                   
      </li>
      <li class="nav-button">
                                           
       <a href="/libraries">
                                            Libraries
                                          </a>
       
                   
      </li>
     </ul>
                  
    </nav>
                  
    <nav class="pure-hidden-md pure-hidden-lg pure-hidden-xl pure-menu
     pure-menu-horizontal flex-col flex-vert pure-u-1-3">
                                                                   
     <ul class="pure-menu-list" style="text-align: center">
      <li class="pure-menu-item pure-menu-has-children pure-menu-allow-hover">
       
                   <a href="#" id="menuLink1" class="pure-menu-link">Menu</a>
       
                   
       <ul class="pure-menu-children mob-menu-list">
        <li class="pure-menu-item mob-menu-item">
                                                                   
         <a href="/platform">
                                                 Tools 
                                               </a>
         
                         
        </li>
        <li class="pure-menu-item mob-menu-item">
                                                                   
         <a href="/users">
                                              Users
                                            </a>
         
                         
        </li>
        <li class="pure-menu-item mob-menu-item">
                                                                   
         <a href="/libraries">
                                                Libraries
                                                
         </a>
                             
        </li>
       </ul>
                        
      </li>
     </ul>
                  
    </nav>
              
   </div>
               
  </header>
                   
  <div class="pure-g">
                                
   <div class="pure-u-1-12 pure-u-md-1-4">
                                                      
    <div class="pure-hidden-xs pure-hidden-sm pure-hidden-md toc-container
     sticky">
     <ul class="toc">
      <li>
       <ul class="toc">
        <li>
         <a class="toc-link toc-item-1" href="#initialising-a-new-library">
          Initialising a New Library
         </a>
         <ul class="toc">
          <li class="toc-li">
           <a class="toc-link toc-item-2" href="#overview">Overview</a>
          </li>
         </ul>
         <ul class="toc">
          <li>
           <a class="toc-link toc-item-2" href="#recommended-workflow">
            Recommended Workflow
           </a>
           <ul class="toc">
            <li class="toc-li">
             <a class="toc-link toc-item-3" href="#opam-and-dune">
              Opam and Dune
             </a>
            </li>
           </ul>
           <ul class="toc">
            <li class="toc-li">
             <a class="toc-link toc-item-3"
              href="#generate-an-opam-file-from-dune">
              Generate an Opam file from Dune
             </a>
            </li>
           </ul>
          </li>
         </ul>
         <ul class="toc">
          <li class="toc-li">
           <a class="toc-link toc-item-2" href="#real-world-examples">
            Real World Examples
           </a>
          </li>
         </ul>
        </li>
       </ul>
      </li>
     </ul>
    </div>
                    
   </div>
                   
   <div class="pure-u-5-6 pure-u-md-1-2">
                                                     
    <main id="main"> 
     <h1 id="initialising-a-new-library">Initialising a New Library</h1>
<p><em>Last Updated: 27, July 2020 at 09:35:49</em></p>
<h2 id="overview">Overview</h2>
<p>Getting started with a project should be simple - ideally a single command would initialise some kind of wizard to guide you through setting a project up. Much like the <code>npm init</code> command which takes answers to populate the <code>package.json</code> file.</p>
<p>This is important because it is very easy to make mistakes in setting up a repository for a new project and the ideal workflow for a library author would to start writing code almost immediately.</p>
<h2 id="recommended-workflow">Recommended Workflow</h2>
<h3 id="opam-and-dune">Opam and Dune</h3>
<p>For a new library there are two key components you will need:</p>
<ol>
<li>Dune files to build the project with dune.
</li>
<li>An opam file to unlock the power of the OCaml platform.
</li>
</ol>
<p>For now, there is no one tool that will accomplish this in one go so multiple tools will be used.</p>
<p>Dune has a <code>dune init</code> command that is very simple and will initialise a bare bones project, executable or library. For a library we can execute <code>dune init library &lt;library-main-file&gt;</code>. This should generate a &quot;Hello World&quot; file and a simple dune file with a <em>library stanza</em>.</p>
<p>The next step is to generate your opam file. There are three ways you can do this:</p>
<ol>
<li>Using opam pin - to edit an opam file  you can use <code>opam pin add . --edit</code> this will open an editor with a prefilled library in it. The slightly confusing aspect to this is that you are also simultaneously pinning the package which you might not want to do.
</li>
<li>Copying an existing opam file and editing it - from the command line <code>opam show &lt;an-installed-packages&gt; --raw</code> will print to stdout the opam file for whatever package you added. You can the redirect this to a file and edit it accordingly.
</li>
<li>By hand - the simplest, but perhaps longest, is to write it by hand.
</li>
</ol>
<p>Regardless of what method you choose, the <code>opam lint</code> command is useful to ensure the opam file has correct syntax.</p>
<h3 id="generate-an-opam-file-from-dune">Generate an Opam file from Dune</h3>
<p>Using the <code>dune-project</code> file to <a href="https://dune.readthedocs.io/en/stable/opam.html#generating-opam-files">generate your opam file</a> is a useful way to ensure your dune dependency is correctly versioned. In this approach you can express your opam file in the dune language and this will automatically generate an opam file for you.</p>
<p>Note that sometimes you need an escape-hatch as the specification in <code>dune-project</code> for opam files is not as flexible as an opam file - for this you should use the <a href="https://dune.readthedocs.io/en/stable/opam.html#opam-template">templates</a> as an escape-hatch.</p>
<h2 id="real-world-examples">Real World Examples</h2>
<p>Many of the community libraries use dune and opam to build their projects - <a href="https://github.com/mirage/ocaml-cstruct">cstruct</a> and <a href="https://github.com/mirage/alcotest">alcotest</a> for example.</p>
<p>Dune itself use the <a href="https://github.com/ocaml/dune/blob/master/dune-project">dune-project</a> approach of generating opam files.</p>

    </main>
                     
   </div>
                 
  </div>
            
          
        </body>
</html>
